name: Algolia Search Scraper

on:
  schedule:
    - cron: "0 8 * * *"
  workflow_dispatch:

jobs:
  build:
    name: Trigger Algolia Scraper
    runs-on: ubuntu-latest
    environment: algolia
    strategy:
      matrix:
        version:
          [
            "teku",
            "goquorum",
            "zkevm",
            "tessera",
            "web3signer",
            "ethsigner",
            "qkm",
            "docs-template",
            "gnark",
          ]
    steps:
      - uses: actions/checkout@v3
      - id: config
        name: Read ${{ matrix.version }}.json
        run: |
          content=$(cat ./.github/config/${{ matrix.version }}.json)
          echo "configJSON=$content" >> $GITHUB_OUTPUT
      - name: Run algolia scraper container
        uses: docker://algolia/docsearch-scraper
        env:
          APPLICATION_ID: ${{ secrets.APPLICATION_ID }}
          API_KEY: ${{ secrets.API_KEY }}
          CONFIG: ${{ fromJson(steps.config.outputs.configJSON) }}
